<!DOCTYPE html>
<html lang="en">
<link href='http://alexgorbatchev.com/pub/sh/current/styles/shCore.css' rel='stylesheet' type='text/css'/>
<link href='http://alexgorbatchev.com/pub/sh/current/styles/shThemeDefault.css' rel='stylesheet' type='text/css'/>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCpp.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCSharp.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushCss.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJava.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPhp.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPython.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushRuby.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushSql.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushVb.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js' type='text/javascript'></script>
<script src='http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPerl.js' type='text/javascript'></script>
<script language='javascript'>
  SyntaxHighlighter.config.bloggerMode = true;
  SyntaxHighlighter.config.clipboardSwf = 'http://alexgorbatchev.com/pub/sh/current/scripts/clipboard.swf';
  SyntaxHighlighter.all();
</script>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="coffeetechgaff.com">
    <meta name="author" content="coffeetechgaff.com">

    <title>coffeetechgaff - Blogs</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">

    <!-- Theme CSS -->
    <link href="../../css/clean-blog.min.css" rel="stylesheet" type="text/css">

    <!-- Custom Fonts -->
    <link href="../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="../../index.html">coffeetechgaff.com</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="../../index.html">Home</a>
                    </li>
                    <li>
                        <a href="../../about.html">About</a>
                    </li>
                    <li>
                        <a href="../../posts.html">Blog</a>
                    </li>
                    <li>
                        <a href="../../contact.html">Contact</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header class="intro-header" style="background-image: url('../../img/GeoServer.png')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Creating a Layer Using Elasticsearch Data on GeoServer and Displaying on LeafLet Map</h1>
                        <span class="meta">Posted by <a href="../../about.html">coffeetechgaff</a> on October 03, 2018</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <h3>Purpose</h3>
                  <p>GeoServer is an open source software server written in Java that allows users to share and edit geospatial data. Designed for interoperability, it publishes data from any major spatial data source using open standards.
                    That's why, we have a requirement to create a layer using Elasticsearch GeoSpatial data on GeoServer and displaying on map using Leaflet.
                    However, leaflet uses <code>EPSG:3857</code> projection which we have to tackle because Geoserver uses <code>EPSG:4326</code> projection.</p>
                    <h3>Dependency</h3>
                    <ol>
                      <li>ElasticSearch latest</li>
                      <li>ElasticGeo 2.13.2</li>
                      <li>GeoServer 2.13.2</li>
                    </ol>
                    <h3>Steps to Create a Layer</h3>
                    <ol>
                      <li>Build the geoserver docker Images using this <a href="../09/building-geoserver-docker-image-for-elasticsearch.html" style="color: #cc0000">article</a></li>
                      <li>Start the ElasticSearch
                        <pre class="brush: cpp">
                          docker run --name elasticsearch-latest -p 9300:9300 -p 9200:9200 -t -d docker.elastic.co/elasticsearch/elasticsearch:6.1.2
                        </pre>
                      </li>
                      <li>Start GeoServers
                        <pre class="brush: cpp">
                          docker run --name geoserver -p 8080:8080 -d geoserver:${IMAGE_TAG}
                        </pre>
                      </li>
                      <li>Open Kitematic
                        <p>You should have Geoserver and Elasticsearch running like following Kitematic screenshot</p>
                        <img src="../../img/2018/10/kitematic.png" alt="Kitematic Window" style="width:900px;height:500px;">
                      </li>
                      <li>Copy python script from <a href="https://gist.github.com/shree665/425a07aa1f8906d54a68306d3e1d3bee" style="color: #cc0000">here</a>
                        and run it by issuing the command to insert some data into Elastic.
                        <p>This python script first create ES mapping for the index, then start to insert the data into Elastic by bulk load, each bulk will insert 20000 point into index, it will repeat 55 times so we can insert more than 1 million records into index.</p>
                        <pre class="brush: cpp">
                          python insertgeoshapedata.py
                        </pre>
                      </li>
                      <li>Using Chrome Extension Elasticsearch Head by installing https://chrome.google.com/webstore/detail/elasticsearch-head/ffmkiejjmecolpfloofpjologoblkegm?hl=en-US, after install,
                        we can view the data in Elasticsearch
                        <img src="../../img/2018/10/elasticsearchhead.png" alt="Chrome Plugin" style="width:900px;height:500px;">
                      </li>
                      <li>Open the local Geoserver http://localhost:8080/geoserver/ with admin username and geoserver as password</li>
                      <li>Create Data Store and Layer for Elasticsearch
                        <ol type="A">
                          <li>Add new Store
                            <img src="../../img/2018/10/geoserverstore.png" alt="GeoServer Store" style="width:900px;height:500px;">
                          </li>
                          <li>Select Elasticsearch Index as Vector Data Sources
                            <img src="../../img/2018/10/elasticsearchvector.png" alt="Vector Datasource" style="width:900px;height:500px;">
                          </li>
                          <li>Put the following value in New Vector Data Source
                            <br>
                            If you are running Docker for mac, you need to do following to find the IP address of ElasticSearch host</p>
                            <ol type="I">
                              <li>First get the CONTAINER ID for elasticsearch-latest by running <code>docker ps</code>. You will get following:
                                <pre class="brush: cpp">
                                  CONTAINER ID        IMAGE                                                 COMMAND                  CREATED             STATUS              PORTS                                            NAMES
                                  210186e03ebf        geoserver:latest                                  "catalina.sh run"        2 weeks ago         Up 2 hours          0.0.0.0:8080->8080/tcp                           geoserver
                                  39e03b4ed70f        docker.elastic.co/elasticsearch/elasticsearch:6.1.2   "/usr/local/bin/do..."   2 weeks ago         Up 2 hours          0.0.0.0:9200->9200/tcp, 0.0.0.0:9300->9300/tcp   elasticsearch-latest
                                </pre>
                              </li>
                              <li>Second inspect the container using <code>docker inspect 39e03b4ed70f</code>. You will see following output and you need see IPAddress attribute for IP address
                                <pre class="brush: cpp">
                                  ...
                                    "Networks": {
                                        "bridge": {
                                            "IPAMConfig": null,
                                            "Links": null,
                                            "Aliases": null,
                                            "NetworkID": "d5cc4ef796e322d23f9ff9a6aa90cbd16b704a65faaad71394486ec8f8ffc3c7",
                                            "EndpointID": "894d5463fa84cb17f6878c50c92386a4597565113ed6777718223fa8448ba30d",
                                            "Gateway": "172.17.0.1",
                                            "IPAddress": "172.17.0.2",
                                            "IPPrefixLen": 16,
                                            "IPv6Gateway": "",
                                            "GlobalIPv6Address": "",
                                            "GlobalIPv6PrefixLen": 0,
                                            "MacAddress": "02:42:ac:11:00:02",
                                            "DriverOpts": null
                                        }
                                    }
                                ....
                                </pre>
                              </li>
                              <img src="../../img/2018/10/editdatastore.png" alt="Vector Store" style="width:900px;height:1200px;">
                            </ol>
                          </li>
                          <li>After click Save, New Layer will show up automatically. Layer name is tanggeoshape_type, tanggeoshape_type is the type in elasticsearch index tanggeoshape, click Publish
                            <img src="../../img/2018/10/newlayer.png" alt="New Layer" style="width:900px;height:500px;">
                          </li>
                          <li>Elasticsearch fields configuration window popup, click the Apply
                            <img src="../../img/2018/10/editlayer.png" alt="Edit Layer" style="width:900px;height:500px;">
                          </li>
                          <li>Edit Layer, change the Name of layer so it is not existed in the system
                            <img src="../../img/2018/10/editlayer1.png" alt="Edit Layer 1" style="width:900px;height:500px;">
                            <img src="../../img/2018/10/editlayer2.png" alt="Edit Layer 2" style="width:900px;height:500px;">
                            <img src="../../img/2018/10/editlayer3.png" alt="Edit Layer 3" style="width:900px;height:200px;">
                          </li>
                          <li>New Layer 'tanggeoshape_type' will show up under Layers
                            <img src="../../img/2018/10/listlayer.png" alt="List of Layers" style="width:900px;height:500px;">
                          </li>
                          <li>Preview the new Layer 'tanggeoshape_type' by clicking under <code>Layer Preview</code> tab on left
                            <img src="../../img/2018/10/layerpreview.png" alt="List of Layers" style="width:900px;height:500px;">
                          </li>
                          <li>After click OpenLayers, the data will show up in the geoserver map
                            <img src="../../img/2018/10/layerpreview1.png" alt="Geoserver Layer Preview" style="width:900px;height:500px;">
                          </li>
                        </ol>
                      </li>
                      <li>Follow https://astuntechnology.github.io/osgis-ol3-leaflet/index.html to display the points on LeafLet
                        <ol type="A">
                          <li>Get the code from Reository
                            <pre class="brush: cpp">
                              git clone https://github.com/AstunTechnology/osgis-ol3-leaflet
                            </pre>
                          </li>
                          <li>Update the leaflet.js as follows which is inside the code which you just clone on above step.
                            <pre class="brush: cpp">
                              var southWest = L.latLng(-180.0, 90.0),
                              northEast = L.latLng(180.0, -90.0),
                              mybounds = L.latLngBounds(southWest, northEast);

                              var map = new L.Map('map', {
                                  crs: L.CRS.EPSG3857,
                                  layers: [
                                      new L.TileLayer(
                                          'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                                          {
                                              attribution: 'Map data © <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
                                          }
                                      )
                                  ]
                              });

                              map.setView([0.0, 0.0], 2);

                              // -- Load GB disticts as a WMS layer --
                              var districtLayer = L.tileLayer.wms('http://localhost:8080/geoserver/cite/wms?tiled=true&', {
                                  layers: 'cite:tanggeoshape_type',
                                  format: 'image/png',
                                  transparent: true,
                                  maxZoom: 14,
                                  minZoom: 0,
                                  continuousWorld: true,
                                  version: '1.1.0'

                              }).addTo(map);
                            </pre>
                          </li>
                          <li>Start the http server by run python
                            <pre class="brush: cpp">
                              python -m http.server
                            </pre>
                          </li>
                          <li>Navigating to http://localhost:8000/leaflet/leaflet.html you should see a map
                            <img src="../../img/2018/10/leaflet.png" alt="Leaflet Preview" style="width:900px;height:500px;">
                          </li>
                        </ol>
                      </li>
                    </ol>
                    <h3>Conclusion</h3>
                    <p>It is very easy to create a layer in GeoServer and access data using <code>WFS</code> and <code>WMS</code> services.
                      On the other hand, Leaflet makes a lot easier to expose data on the map.
                    </p>

                  <hr>
                  <h3>References</h3>
                  <p class="copyright text-muted">Copyright of geoserver image is &copy; <a href="https://de.wikipedia.org/wiki/Datei:GeoServer_Logo.svg">wikipedia.org</a></p>
                  <p>http://geoserver.org</p>
                  <p>https://github.com/ngageoint/elasticgeo</p>
                  <p>https://docs.docker.com/engine/reference/commandline/build/</p>
                </div>
                <hr>
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <div id="disqus_thread"></div>
                  <script>

                  /**
                  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
                  var disqus_config = function () {
                  this.page.url = 'http://coffeetechgaff.com/2018/10/geoserver-with-elasticsearch-and-leaflet.html';
                  this.page.identifier = '/2018/10/geoserver-with-elasticsearch-and-leaflet.html'; variable
                  };
                  (function() { // DON'T EDIT BELOW THIS LINE
                  var d = document, s = d.createElement('script');
                  s.src = 'https://coffeetechgaff-com.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
                  })();
                  </script>
                  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                </div>
            </div>
        </div>
    </article>
    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://www.facebook.com/shree665">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/shree665">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Copyright &copy; coffeetechgaff.com <script>document.write(new Date().getFullYear())</script></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="../../js/jqBootstrapValidation.js"></script>
    <script src="../../js/contact_me.js"></script>

    <!-- Theme JavaScript -->
    <script src="../../js/clean-blog.min.js"></script>

    <!-- Discus comment count -->
    <script id="dsq-count-scr" src="//coffeetechgaff-com.disqus.com/count.js" async></script>
</body>

</html>
